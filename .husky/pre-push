#!/usr/bin/env sh
# Husky pre-push hook (v9+ style)

echo "ðŸš€ Running pre-push checks..."

# Detect Nx for affected optimization - check if workspace exists
if [ -f "nx.json" ] && (command -v nx >/dev/null 2>&1 || npx nx --version >/dev/null 2>&1); then
  echo "ðŸŽ¯ Using Nx affected for fast checks..."
  
  # Calculate base for affected
  BASE_BRANCH="$(git rev-parse --abbrev-ref --symbolic-full-name @{u} 2>/dev/null | cut -d/ -f2- || echo main)"
  BASE="$(git merge-base origin/$BASE_BRANCH HEAD 2>/dev/null || echo HEAD~1)"
  
  # Run affected targets
  npx nx affected -t lint,typecheck,test,build --base="$BASE" --head=HEAD
else
  echo "ðŸ“¦ Running standard checks..."
  
  # Use npm instead of pnpm since package.json shows npm structure
  npm run typecheck --if-present >/dev/null 2>&1 || true
  npm run test --if-present >/dev/null 2>&1 || true  
  npm run build --if-present >/dev/null 2>&1 || true
fi
