#!/usr/bin/env sh
# Husky pre-push hook (v9+ style)

echo "ðŸš€ Running pre-push checks..."

# Check if this is actually an Nx workspace (has nx.json and node_modules/.bin/nx)
if [ -f "nx.json" ] && [ -x "node_modules/.bin/nx" ]; then
  echo "ðŸŽ¯ Using Nx affected for fast checks..."
  
  # Calculate base for affected
  BASE_BRANCH="$(git rev-parse --abbrev-ref --symbolic-full-name @{u} 2>/dev/null | cut -d/ -f2- || echo main)"
  BASE="$(git merge-base origin/$BASE_BRANCH HEAD 2>/dev/null || echo HEAD~1)"
  
  # Run affected targets
  npx nx affected -t lint,typecheck,test,build --base="$BASE" --head=HEAD
else
  echo "ðŸ“¦ Running standard checks..."
  
  # Run standard npm scripts if present
  npm run typecheck --if-present 2>/dev/null || true
  npm run test --if-present 2>/dev/null || true
  npm run build --if-present 2>/dev/null || true
fi
